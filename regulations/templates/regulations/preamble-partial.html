{% load macros render_nested %}

<section id="content-wrapper">
  <section
      id="{{full_id}}"
      class="reg-section"
      data-page-type="preamble-section"
      data-doc-id="{{doc_number}}"
      data-label="{{section_label}}">
    <div id="preamble-read">
      <div class="preamble-content">
        {% if type == "preamble" %}
        <ul>
          {% render_nested template=sub_template context=sub_context %}
        </ul>
        {% else %}
          {% render_nested template=sub_template context=sub_context %}
        {% endif %}
      </div>

      {% include "regulations/footnotes.html" %}
      {% include "regulations/navigation.html" %}
    </div>

    <div id="preamble-write">
      <div class="comment-wrapper">
        {% if meta.accepts_comments %}
          <div class="comment">
            <h4 class="comment-header">You are writing a comment about </h4>

            <div class="comment-context-wrapper">

              <div class="comment-context-toggle">
                <span class="comment-context-text">
                  <span class="fa fa-plus-circle" aria-hidden="true"></span>
                  <span class="fa fa-minus-circle" aria-hidden="true"></span>
                  Show
                  <span class="comment-context-text-more">more</span>
                  <span class="comment-context-text-less">less</span>
                  context for:
                </span>
                <span class="comment-context-label">
                  <span class="comment-context-type">{{ type }}</span>
                  &nbsp;|&nbsp;
                  <span class="comment-context-section"></span>
                </span>
              </div>

              <div class="comment-context"></div>

            </div>

            <h4 class="comment-header">Write your response to </h4>

            <form>
              <div class="editor-container"></div>
              <div class="comment-controls">
                <div class="comment-attachments"></div>
                <label class="comment-upload-button file-upload">
                  Upload Attachment<input type="file" multiple/>
                </label>
                <div class="comment-attachment-count"></div>
                <div class="comment-attachment-limit"></div>
              </div>
              <div class="comment-submission">
                <button class="comment-button" type="submit">Save Response</button>
                <div class="status"></div>
              </div>
            </form>
          </div>
        </div>
        <div class="comment-index">
          <ul class="comment-index-items"></ul>
          <a href="{% url 'comment_review' doc_number=doc_number %}" class="comment-index-review">Review and Submit</a>
        {% else %}
          {% include "regulations/comment-write-closed.html" %}
        {% endif %}
      </div>
    </div>
  </section>
</section>

<script id="comment-attachment-template" type="text/template">
  <div class="comment-attachment">
    <span class="attachment-progress"></span>
    <span class="attachment-filename"><%= name %></span>
    <span class="attachment-size"><%= size %></span>
    <span class="fa fa-times attachment-remove"></span>
  </div>
</script>

<script id="comment-index-template" type="text/template">
  <h4>Your Comment</h4>
  <p class="comment-index-description">
    You have <span class="comment-count"><%= comments.length == 1 ? comments.length + ' response' : comments.length + ' responses' %></span> pending.
  </p>
  <% _.each(comments, function(comment) { %>
    <li
        class="comment-index-item group"
        data-comment-section="<%= comment.id %>"
        data-comment-toc-section="<%= comment.tocId %>"
        data-comment-label="<%= comment.label %>">
      <div class="comment-index-section"><%= comment.label %></div>
      <div class="comment-index-modify">
        <a class="comment-index-edit" title="Edit Comment"><span class="fa fa-pencil-square-o"></span></a>
        <a class="comment-index-clear" title="Remove Comment"><span class="fa fa-times"></span></a>
      </div>
    </li>
  <% }); %>
</script>
