{% load macros render_nested %}

<section id="{{full_id}}" class="reg-section" data-page-type="preamble-section" data-doc-id="{{doc_number}}">
  <ul id="preamble-read">
    {% render_nested template=sub_template context=sub_context %}
  </ul>

  {% if sub_context.node.footnotes %}
  <div class="footnote-box">
      <h5>Footnotes</h5>
      <ul class="footnotes">
          {% for footnote in sub_context.node.footnotes %}
          <li id="footnote-{{footnote.ref}}">
              <span class="reference-num">{{footnote.ref}}.</span>
              <p>
                  {{footnote.note}}
              </p>
          </li>
          {% endfor %}
      </ul>
  </div>
  {% endif %}

  <div id="preamble-write">
    <div class="comment-wrapper">
      <div class="comment">
        <h2>Write your comment.</h2>
        <div class="comment-context"></div>
        <form>
          <div class="editor-container"></div>
          <div class="comment-attachments"></div>
          <input type="file" multiple>
          <button type="submit">Save</button>
          <div class="status"></div>
        </form>
      </div>
    </div>
    <div class="comment-index">
      <ul class="comment-index-items"></ul>
      <a href="{% url 'comment_review' doc_number=doc_number %}" class="comment-index-review">Review</a>
    </div>
  </div>
</section>

<script id="comment-attachment-template" type="text/template">
  <div>
    <%= name %>
    <%= size %>
    <span class="attachment-remove">Remove</span>
    <span class="attachment-progress"><span>
  </div>
</script>

<script id="comment-index-template" type="text/template">
  <% _.each(comments, function(comment) { %>
    <li
        class="comment-index-item group"
        data-comment-section="<%= comment.id %>"
        data-comment-label="<%= comment.label %>">
      <div class="comment-index-section"><%= comment.label %></div>
      <div class="comment-index-modify">
        <span class="comment-index-edit">edit</span>
        <span class="comment-index-clear">remove</span>
      </div>
    </li>
  <% }); %>
</script>
